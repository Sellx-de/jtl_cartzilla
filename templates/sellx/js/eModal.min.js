(function(define){define(["jquery"],function($,root){var $modal;var BIN="recycle-bin";var DIV="<div>";var EMPTY="";var EVENT_CLICK="click";var EVENT_HIDE="hide";var EVENT_SHOW="shown.bs.modal";var EVENT_SUBMIT="submit";var FOOTER_ID="eFooter";var HIDE=EVENT_HIDE+".bs.modal";var INPUT="input";var KEY_DANGER="danger";var LABEL={OK:"Cancel",True:"False",Yes:"No"};var lastParams={};var MODAL_BODY="modal-body";var MODAL_DIALOG=".modal-dialog";var options={};var REC_MODAL_CONTENT="modal-rec";var SIZE={sm:"sm",lg:"lg",xl:"xl"};var TMP_MODAL_CONTENT="modal-tmp";var defaultSettings={allowContentRecycle:true,confirmLabel:Object.keys(LABEL)[0],labels:LABEL,loadingHtml:'<h5>Loading...</h5><div class=progress><div class="progress-bar progress-bar-striped active" style="width: 100%"></div></div>',size:EMPTY,title:"Attention",autofocus:false};root=root||{};root.addLabel=addLabel;root.ajax=ajax;root.alert=alert;root.close=close;root.confirm=confirm;root.emptyBin=emptyBin;root.iframe=iframe;root.prompt=prompt;root.setId=setId;root.setEModalOptions=setEModalOptions;root.setModalOptions=setModalOptions;root.size=SIZE;root.version="1.2.67";return root;function _build(message){$modal.modal(options).find(".modal-content").append(message)}function _createDeferred(){var defer;var q;try{q=require("Q")}catch(e){q=window.Q}if(q){defer=q.defer()}else{defer=$.Deferred();defer.promise=defer.promise()}defer.promise.element=_getModalInstance(true).find(MODAL_DIALOG);return defer}function _getFooter(buttons){if(buttons===false){return EMPTY}var messageFotter=$(DIV).addClass("modal-footer").prop("id",FOOTER_ID);if(buttons){for(var i=0,k=buttons.length;i<k;i++){var btnOp=buttons[i];var btn=$("<button>").addClass("btn btn-"+(btnOp.style||"primary"));for(var index in btnOp){if(btnOp.hasOwnProperty(index)){switch(index){case"close":if(btnOp[index]){btn.attr("data-dismiss","modal").addClass("x")}break;case EVENT_CLICK:var fn=btnOp.click.bind(_getModalInstance(true).find(".modal-content"));btn.click(fn);break;case"text":btn.html(btnOp[index]);break;default:btn.attr(index,btnOp[index])}}}messageFotter.append(btn)}}else{messageFotter.append('<button class="x btn btn-primary" data-dismiss=modal type=button>Close</button>')}return messageFotter}function _getMessage(data){var $message;var content=data.loading?defaultSettings.loadingHtml:data.message||data;if(content.on||content.onclick){$message=data.clone===true?$(content).clone():$(content);$message.addClass(data.useBin&&!data.loading?REC_MODAL_CONTENT:TMP_MODAL_CONTENT)}else{$message=$(DIV).attr("style","position:relative;word-wrap:break-word;").addClass(MODAL_BODY).html(content)}return data.css&&(data.css!==$message.css&&$message.css(data.css)),$message}function _getModalInstance(skipEventChageIfExists){if(!$modal){if(!$("#"+BIN).length){$("body").append($(DIV).prop("id",BIN).hide())}$modal=createModalElement()}if(skipEventChageIfExists&&$modal){return $modal}if(defaultSettings.autofocus){$modal.on(EVENT_SHOW,function(){$(this).find(INPUT).first().focus()})}return $modal;function createModalElement(){return $('<div class="modal fade" tabindex="-1"><style>.modal-title{display:inline;}.modal-xl{width:96%;}.modal-body{max-height: calc(100vh - 145px);overflow-y: auto;}</style>'+"<div class=modal-dialog>"+"<div class=modal-content>"+' <div class=modal-header><h5 class=modal-title></h5><button type=button class="x close" data-dismiss=modal aria-label="Close"><span aria-hidden=true>&times;</span></button></div>'+"</div>"+"</div>"+"</div>").on("hidden.bs.modal",_recycleModal).on(EVENT_CLICK,"button.x",function(ev){var btn=$(ev.currentTarget);if(btn.prop("type")!==EVENT_SUBMIT)return $modal.modal(EVENT_HIDE);try{if(btn.closest("form")[0].checkValidity())return close()}catch(e){return close()}return $modal})}}function _jQueryMinVersion(version){var $ver=$.fn.jquery.split(".");var ver=version.split(".");var $major=$ver[0];var $minor=$ver[1];var $patch=$ver[2];var major=ver[0];var minor=ver[1];var patch=ver[2];return!(major>$major||major===$major&&minor>$minor||major===$major&&minor===$minor&&patch>$patch)}function _recycleModal(){if(!$modal)return;var $content=$modal.find("."+REC_MODAL_CONTENT).removeClass(REC_MODAL_CONTENT).appendTo("#"+BIN);$modal.off(HIDE).off(EVENT_SHOW).find(".modal-content > div:not(:first-child)").remove();if(!defaultSettings.allowContentRecycle||lastParams.clone){$content.remove()}}function _setup(params,title){if(!params)throw new Error("Invalid parameters!");_recycleModal();lastParams=params;var $ref=_getModalInstance();var size="modal-"+(params.size||defaultSettings.size);$ref.find(MODAL_DIALOG).removeClass("modal-sm modal-lg modal-xl").addClass(params.size||defaultSettings.size?size:null);$ref.find(".modal-title").html((params.title||title||defaultSettings.title)+" ").append($("<small>").html(params.subtitle||EMPTY));$ref.on(HIDE,params.onHide)}function addLabel(yes,no){LABEL[yes]=no}function ajax(data,title){var dfd=_createDeferred();if(typeof data==="object"){setEModalOptions(data)}var params={async:true,deferred:dfd,xhrFields:{withCredentials:false},loading:true,title:title||defaultSettings.title,url:data.url||data,dataType:data.dataType||"text"};if(data.url){$.extend(params,data)}$.ajax(params).done(ok).fail(error);return alert(params,title);function ok(html){$modal.find("."+MODAL_BODY).html(data.success?data.success(html):html);return dfd.resolve($modal)}function error(responseText,textStatus){var msg=data.error?data.error(responseText,textStatus,params):'<div class="alert alert-danger">'+"<strong>XHR Fail: </strong>URL [ "+params.url+"] load fail."+"</div>";$modal.find("."+MODAL_BODY).html(msg);return dfd.reject(responseText)}}function alert(data,title){_setup(data,title);var dfd=data.deferred||_createDeferred();if(typeof data==="object"){setEModalOptions(data)}var $message=$(DIV).append(_getMessage(data),_getFooter(data.buttons));_build($message);if(!data.async){$modal.on(EVENT_SHOW,dfd.resolve)}return dfd.promise.then(modal=>{let myModal=new bootstrap.Modal(modal,{});myModal.show()})}function confirm(data,title){var dfd=_createDeferred();if(typeof data==="object"){setEModalOptions(data)}return alert({async:true,buttons:[{close:true,click:click,text:LABEL[data.label]?LABEL[data.label]:LABEL[defaultSettings.confirmLabel],style:data.style&&data.style[0]||KEY_DANGER},{close:true,click:click,text:LABEL[data.label]?data.label:defaultSettings.confirmLabel,style:data.style&&data.style[1]}],deferred:dfd,message:data.message||data,onHide:click,size:data.size,title:data.title||title});function click(ev){close();var key=$(ev.currentTarget).html();return LABEL[key]?dfd.resolve():dfd.reject()}}function iframe(params,title){var dfd=_createDeferred();if(typeof data==="object"){setEModalOptions(data)}var postData=params.data?Object.keys(params.data).map(mapData).join(" "):"";var html=('<div class=modal-body style="position: absolute;width: 100%;background-color: rgba(255,255,255,0.8);height: 100%;">%1%</div>'+'<iframe class="embed-responsive-item" frameborder=0 src="%0%" %2% style="width:100%;height:75vh;display:block;"/>').replace("%0%",params.message||params.url||params).replace("%1%",defaultSettings.loadingHtml).replace("%2%",postData);var message=_jQueryMinVersion("3.0.0")?$(html).on("load",iframeReady):$(html).load(iframeReady);return alert({async:true,buttons:params.buttons||false,deferred:dfd,message:message,size:params.size||SIZE.xl,title:params.title||title});function mapData(item){return item+'="'+params.data[item]+'"'}function iframeReady(){$(this).parent().find("div."+TMP_MODAL_CONTENT).fadeOut(function(){$(this).remove()});return dfd.resolve()}}function emptyBin(){return $("#"+BIN+" > *").remove()}function prompt(data,title){var dfd=_createDeferred();if(typeof data==="object"){setEModalOptions(data)}var params={deferred:dfd};if(typeof data==="object"){$.extend(params,data)}else{params.message=data;params.title=title}params.async=true;if(params.buttons){var btn;for(var i=0,k=params.buttons.length;i<k;i++){btn=params.buttons[i];btn.style=(btn.style||"default")+" pull-left";btn.type=btn.type||"button"}}var buttons=_getFooter([{close:true,type:"reset",text:LABEL.OK,style:KEY_DANGER},{close:false,type:EVENT_SUBMIT,text:defaultSettings.confirmLabel}].concat(params.buttons||[]));params.buttons=false;params.onHide=submit;params.message=$('<form role=form style="margin-bottom:0;">'+"<div class=modal-body>"+"<label for=prompt-input class=control-label>"+(params.message||EMPTY)+"</label>"+'<input type=text class=form-control required autocomplete="on" value="'+(params.value||EMPTY)+(params.pattern?'" pattern="'+params.pattern:EMPTY)+'">'+"</div></form>").append(buttons).on(EVENT_SUBMIT,submit);return alert(params);function submit(ev){var value=$modal.find(INPUT).val();close();ev.type!==EVENT_SUBMIT?dfd.reject(value):dfd.resolve(value);return false}}function setId(id){_getModalInstance(true).find(MODAL_DIALOG).prop("id",id)}function setEModalOptions(overrideOptions){return $.extend(defaultSettings,overrideOptions)}function setModalOptions(overrideOptions){$modal&&$modal.remove();return $.extend(options,overrideOptions)}function close(){if($modal){$modal.off(HIDE).modal(EVENT_HIDE)}return $modal}})})(typeof define=="function"&&define.amd?define:function(args,mName){this.eModal=typeof module!="undefined"&&module.exports?mName(require(args[0],{}),module.exports):mName(window.$)});